try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0f273ac5-ef75-4401-8a75-0cd6cf8f1f16",e._sentryDebugIdIdentifier="sentry-dbid-0f273ac5-ef75-4401-8a75-0cd6cf8f1f16")}catch(e){}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"2c82cb25a14a55e3572d801ec920e9674e6cbd36"};(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[9220],{4834:(e,t,n)=>{function o(){const e=document.getElementById("game-element");try{e?.contentWindow?.frames[0]?.focus()}catch{try{e?.contentWindow?.focus()}catch{e?.focus()}}}n.d(t,{r:()=>o})},9220:(e,t,n)=>{n.r(t),n.d(t,{cloudSaveGameScriptErrorEpic:()=>W,fetchSaveGameEpic:()=>J,fixIOSFullscreen:()=>Z,fullscreenEpic:()=>ne,gameLoadingFinishedEpic:()=>oe,gameLoadingFinishedResetEpic:()=>ie,generateScreenshotEpic:()=>ae,pubHostInitializedEpic:()=>V,receiveScreenshotEpic:()=>ce,sendBugReportEpic:()=>re,setRecentGameEpic:()=>ee,showCSPWarningEpic:()=>se,trackRecentGameEpic:()=>te,updatePokiURLParams:()=>A});var o=n(59099),i=n(8767),a=n(63720),r=n(61701),c=n(62467),s=n(16126),l=n(9336),d=n(76981),p=n(56978),u=n(44240),g=n(67791),f=n(38975),m=n(81160),y=n(39697),w=n(83349),h=n(66847),v=n(29079),E=n(42891),_=n(48554),b=n(46493),S=n(91323),I=n(5298),k=n(13150),D=n(4834),F=n(25302),G=n(58606),O=n(53210),x=n(25733),R=n(6788),T=n(34524),P=n(56469),L=n(67278),N=n(46278),C=n(89385),$=n(83228);const M=50,B=15552e3,H="poki_recentGames";const z=(0,N.T5)();function A(e){return e.pipe((0,v.g)(_.h8.type),(0,o.M)((e=>{const{params:t}=e;if(!t)return;const n=Object.keys(t),o=new URLSearchParams(window.location.search),i=[];o.forEach(((e,t)=>{t.startsWith("gd")&&i.push(t)})),i.forEach((e=>{o.delete(e)})),n.forEach((e=>{o.set(`gd${e}`,t[e])})),window.history.replaceState({},document.title,`${window.location.pathname}?${o.toString()}`)})),(0,i.w)())}function V(e,t){return e.pipe((0,v.g)(_.iG.type),(0,a.n)((e=>{const n=(0,I.Vv)(t.value);return n?((0,b.F)({category:"pubHost",action:"initialized",data:e}),delete e.source,(0,c.of)((0,_.iw)({gameId:n.id,data:e}))):r.w})))}function W(e,t){return e.pipe((0,v.g)(_.Co.type),(0,o.M)((e=>{const n=(0,I.Vv)(t.value);n?.id&&(0,b.F)({category:"account",action:"gamesaveError",data:{gameId:n.id,method:"cloudsavegameScript",context:"cloudsavegame script error",error:e.data?.error}})})),(0,i.w)())}function X(e,t){window.frames?.gameFrame?.postMessage?.({type:"fetchedSaveGame",resolution:e,data:t},"*")}const K={FETCHING:"fetching",DONE:"done"};function U(e){window.frames?.gameFrame?.postMessage?.({type:"fetchGameStatus",status:e},"*")}function J(e,t){return e.pipe((0,v.g)(_.on.type),(0,s.p)((()=>["game","preview","mystery"].includes((0,I.K5)(t.value)))),(0,o.M)((async e=>{const n=(0,I.Vv)(t.value),o=(0,C.Fh)(t.value),i=n?.id;if(U(K.FETCHING),!i)return X("local",{playtime:0,ls:"",idb:""}),void U(K.DONE);const a=e?.metadata?.etag||"";try{let e,i=0,r="cloud",c=!1;if(o.includes(n.id))r="local";else{try{(0,C.Ep)(t.value)&&(e=await(0,$.$)(n.id,a),i=e?.playtime||0,c=!(0,$.jJ)(e))}catch(e){console.error(e),(0,b.F)({category:"account",action:"gamesaveError",data:{gameId:n.id,method:"fetchSaveGameEpic",context:"fetching gamesave from cloud",error:e instanceof Error?e.message:String(e)}})}if(c||(r="local"),"cloud"===r)try{localStorage.removeItem(`playtime-${n.id}`),localStorage.removeItem(`gs-state-token-${n.id}`)}catch{}}(0,b.F)({category:"account",action:"fetchSaveGame",data:{resolution:r,localPlaytime:0,cloudPlaytime:i,receivedPopulatedSaveGameFromCloud:c}}),X(r,e),U(K.DONE)}catch(e){console.error(e),(0,b.F)({category:"account",action:"gamesaveError",data:{gameId:n.id,method:"fetchSaveGameEpic",context:"sending postMessage to gameFrame",error:e instanceof Error?e.message:String(e)}})}})),(0,i.w)())}const Q=()=>document.getElementById("game-container"),j=()=>document.getElementById("game-element"),Y=()=>{j()&&(0,P.e)()};function Z(e,t){if(!(0,E.H6)(t.value)||"undefined"==typeof window)return r.w;const n=(0,l.R)(window,"resize").pipe((0,d.c)(500),(0,a.n)((()=>(Y(),r.w))),(0,p.B)(3e3)),o=(0,l.R)(window,"orientationchange").pipe((0,a.n)((()=>(Y(),r.w))),(0,p.B)(3e3));return e.pipe((0,v.g)(_.gO.type),(0,a.n)((({toggle:t})=>t?((0,D.r)(),Y(),(0,u.h)(n,o).pipe((0,g.Q)(e.pipe((0,v.g)(_.gO.type),(0,s.p)((({toggle:e})=>!e)))))):r.w)))}const q=(e,t)=>{if(!e)return;const n=(0,E.zS)(t),o=(0,E.W3)(t),i=(0,I.Vv)(t),a=(0,E.H6)(t);if("tiktok"===(0,E.zO)(t))return;const r=window?.screen?.orientation?.lock,c=a&&r&&i?.mobile_file?.orientation;if(!n&&!o)try{e.requestFullscreen({navigationUI:"hide"}).catch((()=>{}))}catch{}finally{e.focus()}var s;c&&(s=i.mobile_file.orientation,["portrait","landscape"].includes(s)&&window.screen.orientation.lock(s).catch((()=>{})))};function ee(e,t){if("undefined"==typeof window)return r.w;const n=(0,S.Gd)(t.value);return e.pipe((0,v.g)(E.SG.type,I.yc.type,E.Xy.type),(0,s.p)((()=>"game"===(0,I.K5)(t.value))),(0,a.n)((()=>e.pipe((0,v.g)(_.wZ.type),(0,s.p)((({event:e})=>e===k.Pz)),(0,f.s)(1),(0,m.T)((()=>{const e=(0,I.Vv)(t.value),{id:o}=e||{};if(!o)return r.w;if((0,C.Ep)(t.value))try{const e=`${z}/players/history`;fetch(e,{method:"POST",body:JSON.stringify({game_id:o}),credentials:"include"})}catch(e){}const i=[...(0,E.Fe)(t.value)],a=i.findIndex((e=>e.id===o)),c=a>-1?i.filter((e=>e.id!==o)):i,s={id:o,pt:a>-1?i[a].pt:0,lp:Date.now()};c.unshift(s);const l={recentGames:c.slice(0,100),siteID:n.id};return function({recentGames:e,siteID:t}){if(!t||!e.length)return;const n=e.slice(0,M);document.cookie=`${H}_${t}=${JSON.stringify(n)}; path=/; max-age=${B}`}(l),(0,E.pX)(l)}))))))}function te(e,t){if("undefined"==typeof window)return r.w;const n=(0,S.Gd)(t.value),o=e.pipe((0,v.g)(I.yc.type));return e.pipe((0,v.g)(E.pX.type),(0,a.n)((()=>(0,y.O)(6e4).pipe((0,m.T)((()=>{const{id:e}=(0,I.Vv)(t.value),o=(0,E.Fe)(t.value),i=o.find((t=>t.id===e));if(i){const t=parseInt(i.pt||0,10)+60,a=o.map((n=>n.id===e?{...n,pt:t}:n));return(0,E.pX)({recentGames:a,siteID:n.id})}return r.w})),(0,g.Q)(o)))))}function ne(e,t){const n=(0,l.R)(window,"fullscreenchange").pipe((0,a.n)((()=>(Y(),(0,_.QX)(t.value)!==!!document?.fullscreenElement?(0,E.H6)(t.value)&&!document?.fullscreenElement?r.w:(0,c.of)((0,_.gO)({toggle:!!document?.fullscreenElement})):r.w)))),d=e.pipe((0,v.g)(_.lh.type),(0,s.p)((({toggle:e})=>e)),(0,o.M)((()=>{q(document.body,t.value)})),(0,m.T)((()=>(0,_.gO)({toggle:!0})))),p=()=>{if(!(0,_.QX)(t.value))return r.w;window?.PokiSDK?.stopVideoAd?.(),(0,F.Jb)();try{document?.exitFullscreen?.().catch((()=>{}))}catch{}return window.removeEventListener("resize",Y),window.removeEventListener("orientationchange",Y),(0,c.of)((0,_.gO)({toggle:!1}))},f=e.pipe((0,v.g)(_.lh.type),(0,s.p)((({toggle:e})=>!e)),(0,a.n)((()=>p()))),y=e.pipe((0,v.g)("@@router/LOCATION_CHANGE"),(0,s.p)((()=>!window.location.toString().includes("#fullscreen")&&!window.location.toString().includes("#goog_rewarded"))),(0,a.n)((()=>p()))),w=e.pipe((0,v.g)(_.Br.type),(0,s.p)((()=>(0,E.H6)(t.value))),(0,a.n)((()=>(0,u.h)((0,l.R)(Q(),"click"),(0,l.R)(j(),"click")).pipe((0,s.p)((()=>(0,E.H6)(t.value))),(0,o.M)((()=>{q(document.body,t.value),(0,F.IF)()})),(0,g.Q)(f),(0,i.w)())))),h=e.pipe((0,v.g)(_.gO.type),(0,a.n)((({payload:e})=>{const{toggle:t}=e,{body:n}=document,o=document.getElementById("app-root");return o.style.overflow=t?"hidden":"auto",o.style.height=t?"100svh":"auto",t?n.classList.add("isFullscreen"):n.classList.remove("isFullscreen"),r.w})));return(0,u.h)(d,f,y,n,w,h)}function oe(e){return e.pipe((0,v.g)(_.wZ.type),(0,s.p)((({event:e})=>e===k.NS)),(0,m.T)((()=>(0,_.Rk)(!0))))}function ie(e){return e.pipe((0,v.g)(I.yc.type),(0,m.T)((()=>(0,_.Rk)(!1))))}function ae(e,t){return e.pipe((0,v.g)(_.kK.type),(0,w.c)(3e3),(0,s.p)((()=>window?.frames?.gameFrame)),(0,o.M)((({callback:e})=>{const n="screenshot"===e,o=(0,I.Vv)(t.value);window.frames.gameFrame.postMessage({type:"pokiGenerateScreenshot",hasFrame:n,title:o.title,thumbnail:o.image?.path,callback:e},"*")})))}function re(e,t){return e.pipe((0,v.g)(R.X$.type),(0,w.c)(1e4),(0,a.n)((({payload:e})=>{const{screenshot:n,errors:o}=e,a=(0,R.p3)(t.value),c=(0,G.A)("tracking"),s=(0,O.p)(t.value),l=(0,_.yd)(t.value),d=(0,S.Gd)(t.value),p=(0,I.Vv)(t.value),u=(0,T.nj)(t.value),g=(0,_.zM)(t.value),f=(0,_.pT)(t.value),m=(0,x.v)(t.value),y=l?.gameID===p.pokifordevs_game_id?l.gameVersion:void 0,w=m?.page?.start>0?Date.now()-m.page.start:0,v=document.getElementById("game-element");let E,b;v&&(E=`${v.clientWidth}x${v.clientHeight}`);try{const e=document.createElement("canvas"),t={powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1};let n=e.getContext("webgl2",t);if(n||(n=e.getContext("webgl",t),n||(n=e.getContext("experimental-webgl",t))),n){const e=n.getExtension("WEBGL_debug_renderer_info");e&&(b=n.getParameter(e.UNMASKED_RENDERER_WEBGL)),b||(b=n.getParameter(n.RENDERER))}}catch{}return c("/playground-feedback",{method:"POST",body:JSON.stringify({p4d_game_id:p.pokifordevs_game_id,p4d_version_id:y,type:"bugreport",site_id:d.id,message:a,screenshot:n,experiment:s,adblock:u,was_fullscreen:g,game_resolution:E,loading_finished:f,time_on_page:w,errors:o,webgl_renderer:b,device_pixel_ratio:window.devicePixelRatio||1})}).pipe((0,h.W)((()=>r.w)),(0,i.w)())})))}function ce(e,t){return e.pipe((0,v.g)(_.u9.type),(0,m.T)((e=>e?.data)),(0,a.n)((({screenshot:e,errors:n,callback:o})=>{if("bugReport"===o)try{return(0,c.of)((0,R.X$)({screenshot:e,errors:n}))}catch{return r.w}if("ratings"===o)try{const o=(0,L.xI)(t.value);return(0,c.of)((0,L.rY)({voteDirection:o.voteDirection,message:o.message,screenshot:e,errors:n}))}catch{return r.w}})))}function se(e,t){return e.pipe((0,v.g)(E.Xy.type),(0,f.s)(1),(0,s.p)((()=>"preview"===(0,I.K5)(t.value))),(0,d.c)(1e4),(0,o.M)((()=>{console.info("%cğŸ›¡ï¸ Content Security Policy (CSP) Notice ğŸ›¡ï¸\n\n%cThis website has a strict Content Security Policy.\nIf your game needs to access external resources, please contact us.\n\n%cğŸ“§ Email your exact domains, including ports and protocol, to: developers@poki.com\nğŸ”— Don't forget to include a link to your game!\n\n%cThank you for your cooperation in maintaining our security standards!","font-size: 20px; font-weight: bold; color: #4a90e2;","font-size: 14px; color: #666;","font-size: 14px; color: #0a84ff; font-weight: bold;","font-size: 14px; color: #666; font-style: italic;")})),(0,i.w)())}}}]);
//# sourceMappingURL=client~9220~69ecbda745691ba8e6e6.js.map